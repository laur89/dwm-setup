--- dwm.c
+++ dwm.c
@@ -1614,20 +1588,18 @@
 			r = 1;
 		}
 		if(i < m->nmaster) {
-			h = (m->wh - my) * (c->cfact / mfacts);
+			h = (m->wh - my) / (MIN(n, m->nmaster) - i);
 			resize(c, m->wx, m->wy + my, mw - (2*c->bw), h - (2*c->bw), False);
            if(r)
 				resizeclient(c, m->wx, m->wy + my, mw - (2*c->bw), h - (2*c->bw));
 			my += HEIGHT(c);
-			mfacts -= c->cfact;
 		}
 		else {
-			h = (m->wh - ty) * (c->cfact / sfacts);
+			h = (m->wh - ty) / (n - i);
 			resize(c, m->wx + mw, m->wy + ty, m->ww - mw - (2*c->bw), h - (2*c->bw), False);
 			if(r)
 				resizeclient(c, m->wx + mw, m->wy + ty, m->ww - mw - (2*c->bw), h - (2*c->bw));
 			ty += HEIGHT(c);
-			sfacts -= c->cfact;
 		}
 }
 
